<!DOCTYPE html>
<html>

<head>
    <title>Story-Board</title>
    <link rel="stylesheet" href="index.css">
    <link rel="shortcut icon" href="story-board-icon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
</head>

<body>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./socket.js"></script>
    <!-- <script src="https://unpkg.com/vanilla-picker@2"></script> -->
    <script>
        var colour = "#62B7D9";
        function check() {
            if (document.getElementById('enter-name').value.length == 0) { //enter-name refers to popup textbox
                alert("For fuck's sake enter your username daug!!!");
            }
            else {
                selectColour();
                userName = document.getElementById('enter-name').value;
                var userState = { name: userName, id: userId, line: "", colour: colour };
                socket.emit("new-player", userState, (gameState) => {
                    if(gameState.playerStates.length > 8)
                    {
                        alert("fuck off, we're too busy. No more players allowed");
                        document.getElementById('prevent-play').style.display='block';
                        socket.disconnect();
                    }
                    else
                    {
                        playerStates = gameState.playerStates;
                        addStoryToBox(gameState.story);
                    }
                });
                window.onclick = document.getElementById('submit-user').style.display = 'none';
            }
        }

        window.onkeyup = e =>{
            if (document.getElementById('enter-name').value.length > 0 && document.getElementById('enter-name').value.length < 17) {
                document.getElementById('enter-name').style.borderBottomColor = "#009A44";
                document.getElementById('sub').style.backgroundColor = "#009A44";
            }
            else if (document.getElementById('enter-name').value.length > 16) {
                document.getElementById('enter-name').style.borderBottomColor = "#FF0000";
                document.getElementById('sub').style.backgroundColor = "#faebd7";
                alert("god damn it, use a shorter name. You're intimidating little timmy");
            }
            else if (document.getElementById('enter-name').value.length == 0) {
                document.getElementById('enter-name').style.borderBottomColor = "#faebd7"
                document.getElementById('sub').style.backgroundColor = "#faebd7";
            }

            if ((e.code == "Enter" || e.code == "NumpadEnter") && userName == "" && document.getElementById('enter-name').value.length < 17) {
                check();
            }
        }
    </script>
    <!-- __________________ Starting Popup ______________ -->
    <div class="popup-container" id="submit-user">

        <div class="glass-container">
            <div class="popup-screen">
                <h2>Enter Name and Colour</h2>
                <p type="text" name="colour-selector-name" id="colour-selector-name">selct a colour</p>
                <div class="colour-input">
                    <input type="color" name="colour-selector" id="colour-selector" onmouseleave="selectColour()">
                </div>
                <input type="text" placeholder="Username" id="enter-name" required autocomplete="off">
                <button type="submit" id="sub" onclick="check()">Enter</button>
            </div>
            <div class="rule-box">
                <h3><b>How to Play?</b></h3>
                <hr>
                <ul>
                    <li>Players will be given a piece of story.</li>
                    <li>Enter your spice/part to the story in the "Text box".</li>
                    <li>Once entered a session will be conducted among the players to select/vote the wildest (is what I'd like to say) sentence to progress the story.</li>
                    <li>The highest voted sentence is displayed in the story and progresses the story with the winning player scoring a point.</li>
                </ul>
            </div>
            <!-- <div class="creators">

            </div> -->
        </div>
    </div>
    <!-- __________________ Main page ___________________ -->
    <div class="game-title"> 
        <!-- Game title-->
        <div class="title-box">
            <h1>Story Board</h1>
        </div>
    </div> 

    <div class="leaderboard" id="leaderboard" >
        <h3>leaderboard</h3>
        <hr> 
        <div class="player-list" id="player-list"></div>
    </div>

    <div class="box-container">
        <!-- main story board-->

        <div class="voted-storybox" id = "voted-storybox">
            <!-- Selected/voted sentences to be displayed here -->
        </div>

        <div class="Pactivity-box" id="Pactivity-box">
            <!-- Players activity to be displayed here-->
        </div>

        <div class="text-area">
            <!-- ___________________Textarea________________________-->
            <textarea type = "text" class="enter-box" id = "enter-box" style="resize: none;" onkeyup="checkEnterStory()"></textarea>
            <button class="input-button" onclick="sendStoryLine()">Enter</button>
        </div>

    </div>

    <!-- _____________________POPUP on clicking enter (Voting box)_________________ -->
    <div class="pop-back" id="vote-box">
        <div class="popup-vote" id="popup-vote">
            <!-- slots will be appended here -->
        </div>
    </div>

    <!-- prevent player from interacting with the game -->
    <div class="prevent-player" id="prevent-player" onclick="alert(`voting in progress`)" onkeyup="alert(`voting in progress`)">
       <h2>Voting in progress....</h2>
    </div>

    <!-- prevent player form playing -->
    <div id="prevent-play" class="prevent-play"> Get lost </div>
</body>

</html>